<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>混凝土澆置回報 App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        /* 自定義樣式，用於防止數字輸入框出現上下箭頭 */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        /* 提示框的轉場效果 */
        #toast-notification {
            transition: opacity 0.5s, transform 0.5s;
            transform: translateY(20px);
        }
        #toast-notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        /* 美化日期選擇器的圖示 */
        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            filter: invert(0.7) brightness(1.5);
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 space-y-6">
        <!-- 標題 -->
        <div class="text-center">
            <h1 class="text-2xl md:text-3xl font-bold text-cyan-400">混凝土澆置回報</h1>
            <input type="date" id="report-date" class="bg-gray-800 text-gray-400 border-none rounded-md text-center focus:ring-2 focus:ring-cyan-500 focus:outline-none p-1 mt-2">
        </div>

        <!-- 資訊卡片 -->
        <div class="bg-gray-700/50 p-6 rounded-lg space-y-4">
            <div class="flex justify-between items-center">
                <span class="text-gray-400 text-sm">澆置位置</span>
                <span class="font-semibold text-right">8F柱牆 / 9F樑板區</span>
            </div>
            <hr class="border-gray-600">
            <div class="flex justify-between items-center">
                <span class="text-gray-400 text-sm">灌漿回報</span>
                <span class="font-semibold">09:50 開始澆置</span>
            </div>
            <hr class="border-gray-600">
            <div class="flex justify-between items-center">
                <span class="text-gray-400 text-sm">平均每小時</span>
                <span class="font-semibold">100 M³ (2台壓送)</span>
            </div>
            <hr class="border-gray-600">
            <div class="flex justify-between items-center">
                <span class="text-gray-400 text-sm">本日預計總數</span>
                <span class="font-semibold">625 M³</span>
            </div>
        </div>

        <!-- 動態更新區域 -->
        <div class="space-y-4">
            <div class="bg-gray-700/50 p-4 rounded-lg">
                <label for="m3-per-truck" class="block text-sm font-medium text-gray-400 mb-2">設定/更新 每車平均方數 (M³)</label>
                <input type="number" id="m3-per-truck" value="5.5" class="w-full bg-gray-800 border border-gray-600 rounded-md p-2 text-center text-white font-bold text-lg focus:ring-2 focus:ring-cyan-500 focus:outline-none">
            </div>

            <div class="grid grid-cols-2 gap-4 text-center">
                <div class="bg-gray-900 p-4 rounded-lg">
                    <p class="text-sm text-gray-400">累積出車</p>
                    <p id="truck-count" class="text-4xl font-bold text-amber-400">0</p>
                    <p class="text-sm text-gray-400">車</p>
                </div>
                <div class="bg-gray-900 p-4 rounded-lg">
                    <p class="text-sm text-gray-400">累積澆置數量</p>
                    <p id="volume-count" class="text-4xl font-bold text-green-400">0.0</p>
                    <p class="text-sm text-gray-400">M³</p>
                </div>
            </div>

            <!-- 校正回歸區 -->
            <div class="bg-gray-700/50 p-4 rounded-lg flex items-center gap-2 md:gap-4">
                <input type="number" id="correction-input" placeholder="手動校正總方數" class="flex-grow bg-gray-800 border border-gray-600 rounded-md p-2 text-center text-white font-bold text-lg focus:ring-2 focus:ring-cyan-500 focus:outline-none transition-all">
                <button id="apply-correction" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-lg transition-transform transform active:scale-95">
                    校正
                </button>
            </div>

            <!-- 控制按鈕 -->
            <div class="grid grid-cols-2 gap-4">
                <button id="add-truck" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform active:scale-95">
                    增加一車
                </button>
                <button id="subtract-truck" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform active:scale-95">
                    減少一車
                </button>
            </div>
             <button id="reset-counts" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform active:scale-95">
                重設數據
            </button>
        </div>

        <!-- 操作按鈕 -->
        <div>
            <button id="copy-report" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-transform transform active:scale-95">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                    <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2H6zM8 7a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1zm-1 4a1 1 0 100 2h4a1 1 0 100-2H7z" />
                </svg>
                <span id="copy-text">一鍵複製回報內容</span>
            </button>
        </div>
    </div>

    <!-- 複製成功提示框 -->
    <div id="toast-notification" class="fixed bottom-5 right-5 w-11/12 max-w-sm bg-gray-700 text-white p-4 rounded-lg shadow-lg opacity-0 pointer-events-none">
        <h3 id="toast-title" class="font-bold text-green-400 mb-2"></h3>
        <pre id="copied-content" class="text-sm whitespace-pre-wrap font-sans"></pre>
    </div>


    <script>
        // DOM 元素
        const dateInput = document.getElementById('report-date');
        const truckCountEl = document.getElementById('truck-count');
        const volumeCountEl = document.getElementById('volume-count');
        const m3PerTruckInput = document.getElementById('m3-per-truck');
        const addTruckBtn = document.getElementById('add-truck');
        const subtractTruckBtn = document.getElementById('subtract-truck');
        const resetBtn = document.getElementById('reset-counts');
        const copyBtn = document.getElementById('copy-report');
        const correctionInput = document.getElementById('correction-input');
        const applyCorrectionBtn = document.getElementById('apply-correction');
        const toastNotification = document.getElementById('toast-notification');
        const toastTitle = document.getElementById('toast-title');
        const copiedContent = document.getElementById('copied-content');

        // 初始狀態
        let truckCount = 0;
        let toastTimeout;

        // 設定初始日期為今天
        function setDefaultDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            dateInput.value = `${year}-${month}-${day}`;
        }

        // 更新顯示的函數
        function updateDisplay() {
            const m3PerTruck = parseFloat(m3PerTruckInput.value) || 0;
            const volumeCount = truckCount * m3PerTruck;
            truckCountEl.textContent = truckCount;
            volumeCountEl.textContent = volumeCount.toFixed(1);
        }
        
        // 顯示提示訊息
        function showToast(title, message, type = 'success') {
            toastTitle.textContent = title;
            copiedContent.textContent = message;
            toastTitle.className = `font-bold mb-2 ${type === 'success' ? 'text-green-400' : 'text-amber-400'}`;
            toastNotification.classList.add('show');
            clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => {
                toastNotification.classList.remove('show');
            }, 3000);
        }

        // 事件監聽器
        addTruckBtn.addEventListener('click', () => {
            truckCount++;
            updateDisplay();
        });

        subtractTruckBtn.addEventListener('click', () => {
            if (truckCount > 0) {
                truckCount--;
                updateDisplay();
            }
        });
        
        resetBtn.addEventListener('click', () => {
            if (confirm('您確定要重設所有累積數據嗎？')) {
                truckCount = 0;
                m3PerTruckInput.value = '5.5'; // 重設為預設值
                updateDisplay();
            }
        });

        m3PerTruckInput.addEventListener('input', updateDisplay);

        applyCorrectionBtn.addEventListener('click', () => {
            const correctedVolume = parseFloat(correctionInput.value);
            correctionInput.classList.remove('border-red-500', 'ring-red-500');

            if (isNaN(correctedVolume) || correctedVolume < 0) {
                correctionInput.classList.add('border-red-500', 'ring-red-500');
                correctionInput.value = '';
                correctionInput.placeholder = '請輸入有效數字';
                return;
            }

            if (truckCount <= 0) {
                correctionInput.classList.add('border-red-500', 'ring-red-500');
                correctionInput.value = '';
                correctionInput.placeholder = '請先增加車次';
                return;
            }

            volumeCountEl.textContent = correctedVolume.toFixed(1);
            const newAverage = correctedVolume / truckCount;
            m3PerTruckInput.value = newAverage.toFixed(2);
            
            showToast('校正成功', `總方數已更新為 ${correctedVolume.toFixed(1)} M³\n平均方數已回歸為 ${newAverage.toFixed(2)} M³/車`, 'success');

            correctionInput.value = '';
            correctionInput.placeholder = '手動校正總方數';
        });

        copyBtn.addEventListener('click', () => {
            const selectedDate = new Date(dateInput.value);
            selectedDate.setMinutes(selectedDate.getMinutes() + selectedDate.getTimezoneOffset());
            const rocYear = selectedDate.getFullYear() - 1911;
            const month = selectedDate.getMonth() + 1;
            const day = selectedDate.getDate();
            const formattedDate = `${rocYear}/${month}/${day}`;

            const location = "8F柱牆9FL樑板區";
            const startTime = "09:50";
            const rate = "100M3/小時 (2台壓送)";
            const totalEstimate = "625M3";
            const currentTrucks = truckCountEl.textContent;
            const currentVolume = volumeCountEl.textContent;

            const reportText = `--- 混凝土澆置回報 ---
日期: ${formattedDate}
澆置位置: ${location}
灌漿回報: ${startTime} 開始澆置
平均每小時: ${rate}
本日預計: ${totalEstimate}
--------------------
目前進度:
➡️ 累積出車: ${currentTrucks} 車
➡️ 累積澆置: ${currentVolume} M³`.trim();

            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = reportText;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            
            try {
                document.execCommand('copy');
                showToast('已成功複製內容', reportText, 'success');
            } catch (err) {
                console.error('無法複製文字: ', err);
                showToast('複製失敗', '您的瀏覽器可能不支援此功能。', 'error');
            } finally {
                document.body.removeChild(tempTextArea);
            }
        });

        // 頁面載入時初始化
        setDefaultDate();
        updateDisplay();
    </script>

</body>
</html>
